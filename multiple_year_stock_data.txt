Sub Dosomething()
    Dim xSh As Worksheet
    Application.ScreenUpdating = False
    For Each xSh In Worksheets
        xSh.Select
        Call start
    Next
    Application.ScreenUpdating = True
End Sub


Sub start()
  
    Dim sh As Worksheet
    Set sh = ThisWorkbook.Sheets(ActiveSheet.Name)

    Dim k As Long

    k = sh.Range("A1", sh.Range("A1").End(xlDown)).Rows.Count
    If k = 1048576 Then
        k = 1
    End If
    'MsgBox (k)
    
Dim total_columns As Double
total_columns = k
    
Dim ticker_column As Double
ticker_column = 1

Dim total_stock_column As Double
total_stock_column = 7

Dim ticker_type As String

Dim print_column As Double
print_column = 2

Dim close_value As Double

Dim open_value As Double
open_value = (Cells(2, 3))

Dim yearly_change As Double
Dim percentage_change As Double

Dim total_stock As Double
total_stock = 0

Dim percent_change_colour As Double
percent_change_colour = 11

Cells(1, 9) = "Ticker Type"
Cells(1, 10) = "Yearly Change"
Cells(1, 11) = "Percent Change"
Cells(1, 12) = "Total Stock Volume"

    For i = 2 To total_columns
    'loop through the rows in column ticker
         
        If Cells(i + 1, ticker_column).Value <> Cells(i, ticker_column).Value Then
            'if there is a difference in values
            
                total_stock = total_stock + Cells(i, 7).Value
                'if there is a difference in values, it still adds the total_stock value for that row
                'into the current total_stock
                'it will then reset the counter to 0 so it can count the next ticker total_stock
                
                ticker_type = Cells(i, 1).Value
                'ticker_type variable becomes the string in the ticker type column where the difference was
                
                close_value = Cells(i, 6)
                'close_value = the value of the cell (i counter, column 6)
                
                Range("I" & print_column).Value = ticker_type
                'prints ticker_type into range (I,print_column counter)
                'print column counter is set at 2 at the start
                'so will print at range(I,2)
                'print_column will then = print_column + 1 to continue to next range
                  
                yearly_change = open_value - close_value
                'yearly change calculation
                
                percentage_change = (open_value - close_value) / (open_value)
                'percentage change calculation
                
                Range("J" & print_column).Value = yearly_change
                'prints yearly change into range (J,print_column counter)
                
                Range("K" & print_column).Value = (percentage_change)
                'prints percentage change into range (K,print_column counter)
                
                    
                  
                Range("L" & print_column).Value = (total_stock)
                'prints total_stock into range (L,print_column counter)
                
                total_stock = 0
                  
                print_column = print_column + 1
                
                'now that yearly_change has been calculated
                'we will change the value of open_value to:
                    'where the counter is (the difference in values for ticker type)
                    'which happens to also be where the year changes
                    '+1 to make the counter start in the next year
                    'then we will use that counter position to pull out the next year's first open value
                    
                open_value = Cells((i + 1), 3)
                
                Else
        
                'If there is no difference in ticker type
                total_stock = total_stock + Cells(i, 7).Value
                
                End If
                
                    If Cells(i, percent_change_colour).Value > 0 Then
                        Cells(i, percent_change_colour).Interior.ColorIndex = 4
                    ElseIf Cells(i, percent_change_colour).Value < 0 Then
                        Cells(i, percent_change_colour).Interior.ColorIndex = 3
                    End If
                  
     Next i
     
End Sub

